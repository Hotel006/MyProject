<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>欢迎页面-L-admin1.0</title>
		<meta name="renderer" content="webkit">
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		<meta name="viewport" content="width=device-width,user-scalable=yes, minimum-scale=0.4, initial-scale=0.8,target-densitydpi=low-dpi" />
		<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
		<link rel="stylesheet" href="../../../css/font.css">
		<link rel="stylesheet" href="../../../css/xadmin.css">
		<link rel="stylesheet" type="text/css" href="../../../lib/layui/css/modules/layer/default/layer.css"/>
		<script src="../../../js/shop/chenkin/JQuey.js" type="text/javascript" charset="utf-8"></script>
		<script src="../../../lib/layui/lay/modules/layer.js" type="text/javascript" charset="utf-8"></script>
	</head>
	<body>
		<div class="x-body layui-anim layui-anim-up">
			<blockquote class="layui-elem-quote">欢迎管理员：
				<span class="x-red">test</span>！
				<label id="#clock"></label>
			</blockquote>
			<fieldset class="layui-elem-field">
				<legend>系统通知</legend>
				<div class="layui-field-box">
					<table id="table"  border="1" width="600" cellspacing="0" cellpadding="0" class="layui-table" lay-skin="line" >

						<tr>
							<td onclick="" style="background-color: "> </td>
						</tr>
					</table>
				</div>
			</fieldset>
			<fieldset class="layui-elem-field">
            <legend>系统通知</legend>
            <div class="layui-field-box">
                <table class="layui-table" lay-skin="line">
                    <tbody>
                        <tr>
                            <td >
                                <a class="x-a" href="/" target="_blank">新版L-admin 2.0上线了</a>
                            </td>
                        </tr>
                        <tr>
                            <td >
                                <a class="x-a" href="/" target="_blank">交流qq:(370946531)</a>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </fieldset>
			<script>
				var html = '';
				for (var i = 0; i < 10; i++) {
					var t = new Date();
					var mont = t.getMonth() + 1;
					var nday = t.getDate();

					console.log(ntime);
					html += '<tr>'
					for (var j = 0; j < 5; j++) {
						if (i == 0 && j == 0) {
							html += '<td οnmοusemοve="removeClassType(this)" data-index="' + i + '-' + j + '">room/time</td>'
						} else if (j == 0) {
							html += '<td data-index="' + i + '-' + j + '">10' + i + '</td>'
						} else if (i == 0) {
							var ntime = mont + '-' + (nday + j - 1);
							html += '<td data-index="' + i + '-' + j + '">' + ntime + '</td>'
							console.log(ntime);
						} else {
							html += '<td onclick="tanchuang(this)" data-index="' + i + '-' + j + '"></td>'
						}
					}
					html += '</tr>'
				}
				document.getElementById("table").innerHTML = html;


				var table = document.getElementById("table");
				if (table.rows.length > 0) {
					var rows = table.rows;
					for (var i = 0; i < rows.length; i++) {
						(function(i) {
							var tds = rows[i];
							for (var j = 0; j < tds.cells.length; j++) {
								var obj = tds.cells[j];
								obj.onmouseover = function(e) {
									var val = this.getAttribute('data-index');
									var x = val.split('-')[0];
									var y = val.split('-')[1];
									console.log(val+"-----3")

									var tds = document.getElementsByTagName("td");
									
									for (var k = 0; k < tds.length; k++) {
										
										tds[k].style.backgroundColor = "#fff";
									}

									table.rows[i].style.backgroundColor = "red";

									for (var k = 0; k <= y; k++) {
											table.rows[x].cells[k].style.backgroundColor = "#D2E9FF";
									}
									for (var k = 0; k < x; k++) {
										table.rows[k].cells[y].style.backgroundColor = "#D2E9FF";
									}

								};
							}
						})(i)
					}

				}

				function tanchuang($this) {
					var table = document.getElementById("table");
					var val1 = $($this).attr('data-index');
					var x1 = val1.split('-')[0];
					var y1 = val1.split('-')[1];
					var text =$($this).text();
					var state=text.split('>')[1];
					if (state=='入住中') {
						layer.confirm('此房间已入住，是否修改房间信息？', {
							  btn: ['是','否'] //按钮
							}, function(){
								layer.open({
									  type: 2,
									  title: '入住',
									  shadeClose: true,
									  shade: 0.8,
									  area: ['550px', '90%'],
									  content: 'change.html?room='+x1 //iframe的url
								}); 
							}, function(){
							  layer.msg('确认取消', {
							    time: 300, //20s后自动关闭
							  });
							});
					}else if(state=='已预定'){
						layer.confirm('此房间已被预定，是否入住？', {
							  btn: ['是','否'] //按钮
							}, function(){
								layer.open({
									  type: 2,
									  title: '入住',
									  shadeClose: true,
									  shade: 0.8,
									  area: ['550px', '90%'],
									  content:'Checkin.jsp?room='+x1+'&state=0' //iframe的url
								}); 
							}, function(){
							  layer.msg('确认取消', {
							    time: 300, //20s后自动关闭
							  });
							});
					}else {
						layer.open({
							  type: 2,
							  title: '入住',
							  shadeClose: true,
							  shade: 0.8,
							  area: ['550px', '90%'],
							  content: 'Checkin.jsp?room='+x1+'&state=1' //iframe的url
						}); 
					}
					
				}
				
					
					
					
					function showTime() {
					var t = new Date();
					var year = t.getFullYear(); //年
					var month = t.getMonth(); //月
					var day = t.getDate(); //日
					var week = t.getDay(); //星期
					var arr = new Array("星期日", "星期一", "星期二", "星期三", "星期四", "星期五", "星期六");
					var hour = t.getHours();
					var min = t.getMinutes();
					var second = t.getSeconds();
					var showTime = year + '/' + month + '/' + day + ' ' + arr[week] + ' ' + hour + ((min < 10) ? ":0" : ":") + min + (
						(second < 10) ? ":0" : ":") + second;
					document.getElementById('#clock').innerHTML = showTime;
				}
				function showruzhu() {
					var t = new Date();
					var day = t.getDate(); //日
					var table = document.getElementById("table");
					
					  $.getJSON("${request.getContextPath()}/QueryruzhuServlet.do",function(json){
							$(json.datas).each(function(index,ele) {
									var room=ele.oroom;
									var rztime=ele.oontime;
									 var x = room.split('-')[1];
									 var unixTimestamp = new Date(rztime) ;
									 commonTime = unixTimestamp.toLocaleString();
									 var totle=parseInt(ele.oday);
									 var y = parseInt((commonTime.substring(8,10))-day+1); 
									 var name=ele.oname;
									 var tq=y+totle; 
									 if(tq>0){
										 for (var i=0; i <tq-1; i++) {
											 if(y>0){
												 $("tr:eq("+x+")  td:eq("+(y+i)+")").css("background","#FAEBD7").text(name+"-->入住中");	
											 }
											
										}
										
									 }					
									});
					});  
					  $.getJSON("${request.getContextPath()}/QueryyudingServlet.do",function(json){
							$(json.datas).each(function(index,ele) {
									var room=ele.oroom;
									var yjtime=ele.oydontime;
									 var x = room.split('-')[1];
									 var unixTimestamp = new Date(yjtime) ;
									 commonTime = unixTimestamp.toLocaleString();
									 var totle=parseInt(ele.oday);
									 var y = parseInt((commonTime.substring(8,10))-day+1); 
									 var name=ele.oname;
									 var tq=y+totle;
									 if(tq>0){
										 for (var i=0; i <tq-1; i++) {
											 if(y>0){
												 $("tr:eq("+x+")  td:eq("+(y+i)+")").css("background","#FFD2D2").text(name+"-->已预定");	
											 }
											
										}
										
									 }	
															
									});
						
					});  
					
				}
			
			 	
				
				
				
				$(function() {
					setInterval(showTime, 1000);
					setInterval(showruzhu, 1000);
					
				});
			</script>

	</body>
</html>
